# Raven-锐测 - 产品需求规格说明书 V1.0

| 版本 | 日期 | 作者 | 变更说明 |
| :--- | :--- | :--- | :--- |
| 1.0 | 2025-06-10 | 郭亮\Gemini | 基于初始需求文档进行专业化与格式化修订 |

---

## 1. 引言

### 1.1 项目背景
为优化卫星通信载荷测试人员的工作流程，并提升软件包制作过程的规范性与准确性，特此立项开发名为**Raven-锐测**的专用桌面应用程序。该工具旨在固化标准作业流程、降低人为操作风险，并为后续集成高级智能化功能（如人工智能辅助问答、自动化测试调用等）构建坚实基础。

### 1.2 项目目标
* **近期目标1 (V1.0)**：交付一款具备跨平台图形用户界面（支持Windows及macOS）与命令行接口（支持Linux）的软件包制作工具。此版本需完整支持“灵犀07A”型号的升级包与配置文件包的生成功能。
* **近期目标2 (V1.5)**：工具支持连接基站主控板，并且可以模拟SMU或者调用基站所有对外接口下发或者获取基站相关内容
* **远期规划**：将本工具作为软件智能体（Agent）的核心能力进行演进，与检索增强生成（RAG）及大型语言模型（LLM）技术深度融合，以实现通过自然语言交互提供领域知识问答及自动化任务执行等高级服务。

---

## 2. 总体设计与架构

### 2.1 运行模式
* **图形用户界面模式 (GUI Mode)**：为Windows与macOS用户提供统一、直观的图形化操作环境。
* **命令行接口模式 (CLI Mode)**：为Linux环境提供功能完备的命令行接口，以支持自动化脚本集成与批量处理任务。

### 2.2 图形用户界面（GUI）布局
应用程序主窗口由以下关键区域构成：
1.  **软件包版本号输入域**：供用户指定最终输出软件包的版本标识符（示例：`V1.0.0.7`）。
2.  **多功能标签页**：用于在不同打包任务间进行切换。
    * `标签页一：灵犀07A升级包制作`
    * `标签页二：灵犀10升级包制作` (V1.0 版本暂不实现)
    * `标签页三：三标段升级包制作` (V1.0 版本暂不实现)
    * `标签页四：灵犀07A配置文件包制作`
    * `标签页五：智能交互助手 (ChatBot)` (V1.0 版本仅预留界面，功能待实现)
3.  **执行打包操作按钮**：触发软件包生成流程。
4.  **状态与日志输出面板**：用于展示实时操作进程、成功信息或错误警报。

---

## 3. 功能模块一：灵犀07A升级包制作

### 3.1 用户界面规格 (标签页一)
该界面需为下表所列的各软件组件提供文件选择控件及版本号输入框。

| 组件逻辑名称 | 目标文件名称（包内） | FileAttr | 文件类型/说明 |
| :--- | :--- | :--- | :--- |
| OAM软件 | `gnb-oam-lx07a` | `301` | 单一文件 |
| 主控板FPGA | `sct.bin` | `303` | 二进制文件 (`.bin`) |
| 基带板FPGA | `bposc.bin` | `310` | 二进制文件 (`.bin`) |
| QV基带FPGA | `bpoqv.bin` | `315` | 二进制文件 (`.bin`) |
| 协议栈软件 (CUCP) | `cucp.deb` | `302` | Debian软件包 (`.deb`) |
| 协议栈软件 (CUUP) | `cuup.deb` | `307` | Debian软件包 (`.deb`) |
| 协议栈软件 (DU) | `du.deb` | `308` | Debian软件包 (`.deb`) |

此外，界面须包含一个 **“生成补丁(Patch)包”** 的复选框。

### 3.2 核心处理逻辑
1.  **文件选择**：用户通过文件选择控件，可为任一组件指定单个文件（如`.bin`, `.deb`）或一个压缩存档（支持`.zip`, `.rar`, `.tgz`格式）。
2.  **版本号处理**：
    * **自动化解析**：系统应具备从符合特定命名规范（如 `gnb-oam-lx07a_v1001_...`）的文件或压缩包中自动提取版本信息的能力。解析出的版本号（例如 `v1001`）需转换为标准格式（`V1.0.0.1`）并自动填充至相应的版本号输入框。此项为推荐实现的用户体验优化。
    * **用户可编辑性**：版本号输入框必须允许用户手动编辑。当文件名不符合规范或解析失败时，该输入框应为空，并要求用户手动输入。
3.  **文件解压与提取**：
    * 若用户输入为压缩存档，系统须自动执行解压操作。
    * 在解压目录中，依据上表定义的“文件类型”定位目标文件。
    * **文件标准化**：无论原始文件名为何，系统均应将找到的目标文件重命名为上表规定的“目标文件名称”，以确保包内文件名的统一性。
    * **错误处理**：若在指定路径或解压目录中未能定位到预期的文件类型，系统必须中止该组件的处理流程，并在日志输出区提供明确的错误信息。
4.  **补丁（Patch）包生成逻辑**：
    * 当用户触发“打包”操作时，系统首先校验已选组件的数量。
    * 若已选组件未能覆盖全部七个必要组件，系统应执行以下交互：
        1.  呈现一则通知，告知用户：“检测到组件选择不完整，操作将默认为生成补丁包。”
        2.  用户确认该通知后，系统将自动激活“生成补丁(Patch)包”的复选框。
    * 若用户已手动激活该复选框，则系统将无视组件选择数量，直接执行补丁包生成逻辑。

### 3.3 `si.ini` 配置文件生成规范

#### 3.3.1 完整升级包 (Full Package)
在“生成补丁(Patch)包”复选框未被激活且所有组件均已选定的条件下：
* `PacketAtttir` 字段值固定为 `1001`。
* **格式示例**：
    ```ini
    Packet_Ver=V1.0.0.7;
    PacketAtttir=1001;
    Publisher=yinhe;
    FileNumInPacket=7;

    FileName_1=gnb-oam-lx07a;
    FileAttr_1=301;
    FileVer_1=V1.0.0.1;

    // ... 其余文件条目 ...
    ```

#### 3.3.2 补丁包 (Patch Package)
在“生成补丁(Patch)包”复选框被激活的条件下：
* `PacketAtttir` 字段值固定为 `1002`。
* `FileNumInPacket` 字段及文件列表仅包含用户已选择的组件。
* **格式示例 (假设仅选择OAM与主控FPGA)**：
    ```ini
    Packet_Ver=V1.0.0.7-Patch;
    PacketAtttir=1002;
    Publisher=yinhe;
    FileNumInPacket=2;

    FileName_1=gnb-oam-lx07a;
    FileAttr_1=301;
    FileVer_1=V1.0.0.1;

    FileName_2=sct.bin;
    FileAttr_2=303;
    FileVer_2=1.2.0.7;
    ```

### 3.4 最终产物规格
* **内容构成**：包含所有经过标准化重命名的组件文件及生成的`si.ini`配置文件。
* **存档格式**：`tgz`。
* **命名约定**：`GalaxySpace-Lx07A-YYYYMonDD-HHMM-Vxxxx[-Patch].tgz`
    * `YYYYMonDD-HHMM`：表示打包操作执行时的精确日期与时间戳。
    * `Vxxxx`：源于“软件包版本号”输入框，移除所有点号 (`.`)。
    * `-Patch`：当且仅当生成类型为补丁包时，添加此后缀。

---

## 4. 功能模块二：灵犀07A配置文件包制作

### 4.1 用户界面规格 (标签页四)
该界面需为下表中的所有配置文件提供文件选择控件。

| 目标文件名称（包内） | FileAttr |
| :--- | :--- |
| `conf.gnb_cucp.gnb.json` | `317` |
| `conf.gnb_cucp.stack.json`| `318` |
| `conf.gnb_cuup.gnb.json` | `319` |
| `conf.gnb_cuup.stack.json`| `320` |
| `conf.gnb_du.gnb.json` | `321` |
| `conf.gnb_du.stack.json` | `322` |
| `cwmp_data.xml` | `316` |

### 4.2 核心处理逻辑
1.  **文件选择**：用户为任意数量的目标配置项指定本地源文件。
2.  **文件标准化**：系统自动将用户选择的源文件重命名为上表规定的目标文件名。
3.  **打包执行**：用户触发打包操作后，系统依据当前已选择的文件列表生成`si.ini`并完成打包。

### 4.3 `si.ini` 配置文件生成规范
* `PacketAtttir` 字段值固定为 `1300`。
* `Packet_Ver` 及所有 `FileVer_*` 字段均使用“软件包版本号”输入框的当前值。
* `FileNumInPacket` 字段及文件列表仅反映用户已选择的配置文件。
* **格式示例 (假设选择了3个文件)**：
    ```ini
    Packet_Ver=V1.0.0.0;
    PacketAtttir=1300;
    Publisher=yinhe;
    FileNumInPacket=3;

    FileName_1=cwmp_data.xml;
    FileAttr_1=316;
    FileVer_1=V1.0.0.0;

    // ... 其余已选文件条目 ...
    ```

### 4.4 最终产物规格
* **内容构成**：包含所有用户选择并经过标准化的配置文件及生成的`si.ini`。
* **存档格式**：`tgz`。
* **命名约定**：`GalaxySpace-Lx07A-YYYYMonDD-HHMM-Vxxxx-Config.tgz`
    * `-Config`：固定后缀，用以明确标识此包为配置文件包。

---

## 5. 命令行接口（CLI）规范
为支持在Linux环境中进行自动化操作，须提供以下命令行接口。

**场景一：创建灵犀07A完整升级包**
```bash
python packager.py create-upgrade \
    --target lx07a \
    --pkg-ver V1.0.0.8 \
    --oam /path/to/gnb-oam-lx07a_v1002.zip --oam-ver V1.0.0.2 \
    --fpga-main /path/to/sct_v1208.bin --fpga-main-ver V1.2.0.8 \
    ... # 其他组件参数
```

**场景二：创建补丁包**
```bash
python packager.py create-upgrade \
    --target lx07a \
    --pkg-ver V1.0.0.8 \
    --patch \
    --oam /path/to/gnb-oam-lx07a_v1003.zip --oam-ver V1.0.0.3
```

**场景三：创建配置文件包**
```bash
python packager.py create-config \
    --target lx07a \
    --pkg-ver V1.0.0.1 \
    --file /path/to/local/cwmp_data.xml \
    --file /path/to/local/conf.gnb_cucp.gnb.json
```

---

## 6. 产品路线图
* **V1.1**：实现“灵犀10”与“三标段”型号的升级包制作功能。
* **V2.0**：集成智能交互助手前端，并与大型语言模型后端对接，初步实现基于检索增强生成的领域知识问答能力。
* **V2.1**：实现工具调用（Tool Calling）功能，使用户能够通过自然语言指令驱动自动化打包任务。
